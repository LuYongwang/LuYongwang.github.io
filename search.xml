<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Elasticsearch - (1)概述和安装</title>
      <link href="/post/Elasticsearch1.html"/>
      <url>/post/Elasticsearch1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Elasticsearch-概述和安装"><a href="#Elasticsearch-概述和安装" class="headerlink" title="Elasticsearch - 概述和安装"></a>Elasticsearch - 概述和安装</h1><p><code>本文所有操作生效于 2022-10-01 最新版本elasticsearch:8.4.2 操作系统为Mac m1pro </code> 这里只讲述, 学习过程中的基本环境安装,如果是生产环境高可用集群搭建. 后续看单独部署文章.</p><h2 id="Elasticsearch概述"><a href="#Elasticsearch概述" class="headerlink" title="Elasticsearch概述"></a>Elasticsearch概述</h2><h3 id="官网和文档"><a href="#官网和文档" class="headerlink" title="官网和文档"></a>官网和文档</h3><p><a href="https://www.elastic.co/">https://www.elastic.co</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro.html</a></p><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p><em><strong>Elasticsearch</strong></em>是一个近实时的分布式搜索和分析引擎。它可以帮助你用前所未有的速度去处理大规模数据, 它不但稳定、可靠、快速，而且也具有良好的水平扩展能力，是专门为分布式环境设计的,它可以用于全文搜索，结构化搜索以及分析，当然你也可以将这三者进行组合。Elasticsearch是一个建立在全文搜索引擎 Apache Lucene 基础上的搜索引擎，可以说Lucene是当今最先进，最高效的全功能开源搜索引擎框架.</p><img src="https://res.yongwang.lu/img/202209301525318.png"/><h3 id="发展历程"><a href="#发展历程" class="headerlink" title="发展历程"></a>发展历程</h3><h2 id="Elasticsearch安装"><a href="#Elasticsearch安装" class="headerlink" title="Elasticsearch安装"></a>Elasticsearch安装</h2><h3 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h3><h4 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h4><p><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p><img src="https://res.yongwang.lu/img/image-20220930114527010.png" alt="image-20220930114527010" style="zoom: 33.5%;" /><img src="https://res.yongwang.lu/img/image-20220930114329496.png" alt="image-20220930114329496" style="zoom:50%;" /><h4 id="安装启动过程"><a href="#安装启动过程" class="headerlink" title="安装启动过程"></a>安装启动过程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载对应tar.gz包 放到指定目录</span></span><br><span class="line">yongwang.lu@bogon[~/DevSoft] tree .</span><br><span class="line">.</span><br><span class="line">└── elasticsearch-8.4.2-darwin-aarch64.tar.gz</span><br><span class="line"></span><br><span class="line">0 directories, 1 file</span><br><span class="line"> yongwang.lu@bogon[~/DevSoft] tar -zxf elasticsearch-8.4.2-darwin-aarch64.tar.gz</span><br><span class="line"> yongwang.lu@bogon[~/DevSoft] <span class="built_in">ls</span> -l</span><br><span class="line">total 721008</span><br><span class="line">drwxr-xr-x@ 12 yongwang.lu  staff        384  9 15 00:30 elasticsearch-8.4.2</span><br><span class="line">-rw-r--r--@  1 yongwang.lu  staff  357145358  9 30 11:50 elasticsearch-8.4.2-darwin-aarch64.tar.gz</span><br><span class="line"> yongwang.lu@bogon[~/DevSoft] <span class="built_in">cd</span> elasticsearch-8.4.2</span><br><span class="line"> yongwang.lu@bogon[~/DevSoft/elasticsearch-8.4.2] <span class="built_in">ls</span> -l</span><br><span class="line">total 4296</span><br><span class="line">-rw-r--r--@  1 yongwang.lu  staff     3860  9 15 00:25 LICENSE.txt</span><br><span class="line">-rw-r--r--@  1 yongwang.lu  staff  2187100  9 15 00:29 NOTICE.txt</span><br><span class="line">-rw-r--r--@  1 yongwang.lu  staff     8107  9 15 00:25 README.asciidoc</span><br><span class="line">drwxr-xr-x@ 24 yongwang.lu  staff      768  9 15 00:30 bin</span><br><span class="line">drwxr-xr-x@ 11 yongwang.lu  staff      352  9 15 00:30 config</span><br><span class="line">drwxr-xr-x@  3 yongwang.lu  staff       96  9 15 00:30 jdk.app</span><br><span class="line">drwxr-xr-x@ 36 yongwang.lu  staff     1152  9 15 00:30 lib</span><br><span class="line">drwxr-xr-x@  2 yongwang.lu  staff       64  9 15 00:29 logs</span><br><span class="line">drwxr-xr-x@ 66 yongwang.lu  staff     2112  9 15 00:30 modules</span><br><span class="line">drwxr-xr-x@  2 yongwang.lu  staff       64  9 15 00:29 plugins</span><br><span class="line"> yongwang.lu@bogon[~/DevSoft/elasticsearch-8.4.2] ./bin/elasticsearch</span><br><span class="line"> <span class="comment"># 中间日志省略</span></span><br><span class="line">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br><span class="line">✅ Elasticsearch security features have been automatically configured!</span><br><span class="line">✅ Authentication is enabled and cluster connections are encrypted.</span><br><span class="line"></span><br><span class="line">ℹ️  Password <span class="keyword">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class="line">  rGXkiS7wwOP9ApnMaTzJ</span><br><span class="line"></span><br><span class="line">ℹ️  HTTP CA certificate SHA-256 fingerprint:</span><br><span class="line">  efdf407f44f069ca5f806ea1a6b51d37f5093a3fff89197194172ac2a69638ee</span><br><span class="line"></span><br><span class="line">ℹ️  Configure Kibana to use this cluster:</span><br><span class="line">• Run Kibana and click the configuration <span class="built_in">link</span> <span class="keyword">in</span> the terminal when Kibana starts.</span><br><span class="line">• Copy the following enrollment token and <span class="built_in">paste</span> it into Kibana <span class="keyword">in</span> your browser (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjQuMiIsImFkciI6WyIxNzIuMTcuOTMuNDA6OTIwMCJdLCJmZ3IiOiJlZmRmNDA3ZjQ0ZjA2OWNhNWY4MDZlYTFhNmI1MWQzN2Y1MDkzYTNmZmY4OTE5NzE5NDE3MmFjMmE2OTYzOGVlIiwia2V5IjoiX29mdGpJTUJfeDFUUVU0WFdJTUg6TVJaM2Y2V0ZTTHF5Nlk3LVZsbmVSQSJ9</span><br><span class="line"></span><br><span class="line">ℹ️  Configure other nodes to <span class="built_in">join</span> this cluster:</span><br><span class="line">• On this node:</span><br><span class="line">  ⁃ Create an enrollment token with `bin/elasticsearch-create-enrollment-token -s node`.</span><br><span class="line">  ⁃ Uncomment the transport.host setting at the end of config/elasticsearch.yml.</span><br><span class="line">  ⁃ Restart Elasticsearch.</span><br><span class="line">• On other nodes:</span><br><span class="line">  ⁃ Start Elasticsearch with `bin/elasticsearch --enrollment-token &lt;token&gt;`, using the enrollment token that you generated.</span><br><span class="line">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></pre></td></tr></table></figure><p>这样就最简单的安装成功了.  </p><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&quot;https://127.0.0.1:9200/&quot;</span> --header <span class="string">&quot;Authorization: Basic ZWxhc3RpYzpyR1hraVM3d3dPUDlBcG5NYVR6Sg==&quot;</span> -k</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;bogon&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;xOqEJgnDROCrmf0svgiVHg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;8.4.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;tar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;89f8c6d8429db93b816403ee75e5c270b43a940a&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2022-09-14T16:26:04.382547801Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;9.3.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;7.17.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;7.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从Elasticsearch8开始默认开启证书和账号密码配置. <code>Authorization: Basic ZWxhc3RpYzpyR1hraVM3d3dPUDlBcG5NYVR6Sg==</code> 请求头是账号密码传入. 本文不会安装kibana等工具来辅助.</p><p>第一次启动日志中 拿到密码 base64(username:passwd) 则 base64(elastic:rGXkiS7wwOP9ApnMaTzJ)</p><h3 id="IK分词器安装"><a href="#IK分词器安装" class="headerlink" title="IK分词器安装"></a>IK分词器安装</h3><p>插件github地址 <a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p><h4 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.4.2/elasticsearch-analysis-ik-8.4.2.zip</span><br><span class="line">-&gt; Installing https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.4.2/elasticsearch-analysis-ik-8.4.2.zip</span><br><span class="line">-&gt; Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.4.2/elasticsearch-analysis-ik-8.4.2.zip</span><br><span class="line">[=================================================] 100%</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果网络不好可以增加github代理  <a href="https://ghproxy.com/https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.4.2/elasticsearch-analysis-ik-8.4.2.zip">https://ghproxy.com/https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.4.2/elasticsearch-analysis-ik-8.4.2.zip</a></p><p><code>注意: 这里版本号和es必须保持强一致, 否则会出现如下错误信息</code> </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin [analysis-ik] was built for Elasticsearch version 8.4.1 but version 8.4.2 is running</span><br></pre></td></tr></table></figure><p>重启Es 注意观察日志 出现 <code>loaded plugin [analysis-ik]</code>则说明加载成功.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[2022-10-01T14:21:51,107][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-shutdown]</span><br><span class="line">[2022-10-01T14:21:51,107][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-sql]</span><br><span class="line">[2022-10-01T14:21:51,107][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-stack]</span><br><span class="line">[2022-10-01T14:21:51,108][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-text-structure]</span><br><span class="line">[2022-10-01T14:21:51,108][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-voting-only-node]</span><br><span class="line">[2022-10-01T14:21:51,108][INFO ][o.e.p.PluginsService     ] [bogon] loaded module [x-pack-watcher]</span><br><span class="line">[2022-10-01T14:21:51,108][INFO ][o.e.p.PluginsService     ] [bogon] loaded plugin [analysis-ik]</span><br><span class="line">[2022-10-01T14:21:52,227][INFO ][o.e.e.NodeEnvironment    ] [bogon] using [1] data paths, mounts [[/System/Volumes/Data (/dev/disk3s5)]], net usable_space [763.5gb], net total_space [926.3gb], types [apfs]</span><br></pre></td></tr></table></figure><h4 id="插件测试"><a href="#插件测试" class="headerlink" title="插件测试"></a>插件测试</h4><h5 id="ik-max-word"><a href="#ik-max-word" class="headerlink" title="ik_max_word"></a><strong>ik_max_word</strong></h5><p>文本做最细粒度的拆分 例如: <code>庆祝中华人民共和国成立73周年</code>. 会拆分成:  庆祝 中华人民共和国 中华人民 中华 华人 人民共和国 人民 共和国</p><p>共和 国 成立 73 周年 周 年</p><p>请求如下: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">curl -k -X GET <span class="string">&#x27;https://127.0.0.1:9200/_analyze&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Basic ZWxhc3RpYzpyR1hraVM3d3dPUDlBcG5NYVR6Sg==&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data-raw <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">    &quot;text&quot;: &quot;庆祝中华人民共和国成立73周年&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> | jq</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;庆祝&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;中华人民共和国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;中华人民&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 6,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;中华&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 4,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;华人&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 3,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 5,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;人民共和国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 4,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;人民&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 4,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 6,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;共和国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 6,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;共和&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 6,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 8,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 8,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_CHAR&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;成立&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 11,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;73&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 11,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 13,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ARABIC&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;周年&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 13,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 15,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;COUNT&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;周&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 13,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 14,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;COUNT&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 13</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;年&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 14,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 15,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;COUNT&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 14</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ik-smart"><a href="#ik-smart" class="headerlink" title="ik_smart"></a><strong>ik_smart</strong></h5><p>会做最粗粒度的拆分 </p><p>例如: <code>庆祝中华人民共和国成立73周年</code>. 会拆分成:  庆祝  中华人民共和国 成立  73周年</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">curl -k -X GET <span class="string">&#x27;https://127.0.0.1:9200/_analyze&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Basic ZWxhc3RpYzpyR1hraVM3d3dPUDlBcG5NYVR6Sg==&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data-raw <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;analyzer&quot;: &quot;ik_smart&quot;,</span></span><br><span class="line"><span class="string">    &quot;text&quot;: &quot;庆祝中华人民共和国成立73周年&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;庆祝&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;中华人民共和国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;成立&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 9,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 11,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;73周年&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: 11,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: 15,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TYPE_CQUAN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: 3</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
